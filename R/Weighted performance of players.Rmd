---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
plot(cars)
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file).

```{r, echo=FALSE}
library(data.table)
events = read.csv('../CSV/events.csv',sep = ';',header = T)
match_info = read.csv('../CSV/match_info.csv',sep = ';',header = T)
match_info$season = substr(match_info$start_date,1,4)
events = merge(match_info[,c('match_id','season')]
               ,events
               ,by = 'match_id')
```
```{r}
events = as.data.table(events)
innings_summary = events[,list(total_balls = length(ball[!(extra_type %in%
                                                              c('wides'
                                                                ,'noballs'))])
                               ,total_runs = sum(total_runs)
                               ,extra_runs = sum(extra_runs)
                               ,wickets = length(out_type[out_type != 'none']))
                         ,by="season,match_id,innings,batting_team,bowling_team"]

batsman_summary = events[,list(runs = sum(batsman_runs)
                               ,balls = length(ball[!(extra_type %in% c("wides","noballs"))])
                               ,out = length(out_type[out_type != 'none'])
                               ,in_over = min(over))
                         ,by="season,match_id,innings,batting_team,bowling_team,batsman"]
bowler_summary = events[,list(runs=sum(total_runs[!(extra_type %in% c("byes","legbyes"))])
                              ,balls=length(extra_type[!(extra_type %in% c('noballs','wides'))])
                              ,wickets=length(out_type[out_type%in%c('bowled'
                                                                     ,'caught'
                                                                     ,'caught and bowled'
                                                                     ,'hit wicket'
                                                                     ,'lbw'
                                                                     ,'stumped')]))
                        ,by="season,match_id,innings,batting_team,bowling_team,bowler"]

batsman_summary = merge(batsman_summary
                        ,innings_summary[,c('season'
                                            ,'match_id'
                                            ,'innings'
                                            ,'total_balls'
                                            ,'total_runs'
                                            ,'wickets')]
                        ,by= c('season','match_id','innings'))

```

